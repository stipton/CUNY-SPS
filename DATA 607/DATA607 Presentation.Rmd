---
title: "DATA 607 Presentation"
subtitle: "Confusion Matrices"
author: "Steve Tipton"
date: "March 14, 2018"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

## Long, long ago....

Recall the question Zack Dravis left us with at the end of his presentation on KNN (K numbered neighbors):

*"How to measure success [of the knn model]?"*

```{r, echo = FALSE, warning = FALSE, message = FALSE}
set.seed(1234)

HumanHeight <- rnorm(200, mean = 5.5, sd = .5)
WookieHeight <- rnorm(200, mean = 7.0, sd = .75)
EwokHeight <- rnorm(200, mean = 4, sd = .5)

HumanWeight <- rnorm(200, mean = 150, sd = 30)
WookieWeight <- rnorm(200, mean = 200, sd = 50)
EwokWeight <- rnorm(200, mean = 125, sd = 30)

SWSpecies <- data.frame(Species = c(rep("Human", 200), rep("Wookie", 200), rep("Ewok", 200)), Height = c(HumanHeight, WookieHeight, EwokHeight), Weight = c(HumanWeight, WookieWeight, EwokWeight))

library(ggplot2)
library(dplyr)

#Split into training and test
TrainingData <- SWSpecies %>%
  group_by(Species) %>%
  slice(1:133) %>%
  ungroup()

TestData <- SWSpecies %>%
  group_by(Species) %>%
  slice(134:200) %>%
  ungroup()

library(class)


library(knitr)
library(kableExtra)
```

## Summarize Zach's project

http://rpubs.com/zdravis/368000

## Running the process with two different $k$ values

```{r}
SpeciesPrediction <- knn(train = select(TrainingData, Height, Weight), 
                         test = select(TestData, Height, Weight), 
                         cl = TrainingData$Species, 
                         k = 3)
FirstTest <- cbind(TestData, SpeciesPrediction)
FirstTest %>%  kable("html", caption = "k = 3") %>%
  kable_styling(bootstrap_options = c("striped")) %>%
  scroll_box(height = "500px")
```

```{r}
SpeciesPrediction <- knn(train = select(TrainingData, Height, Weight), 
                         test = select(TestData, Height, Weight), 
                         cl = TrainingData$Species, 
                         k = 9)
SecondTest <- cbind(TestData, SpeciesPrediction)
SecondTest %>%  kable("html", caption = "k = 9") %>%
  kable_styling(bootstrap_options = c("striped")) %>%
  scroll_box(height = "500px")
```

## Create simulation of base results

```{r}
simSpeciesPrediction <- c(rep("Human", 67), rep("Wookie", 67), rep("Ewok", 67))
randOrder <- sample(1:201, 201, replace = FALSE)
simSpeciesPrediction <- simSpeciesPrediction[randOrder]
BaseTest <- cbind(TestData, simSpeciesPrediction)
BaseTest %>%  kable("html", caption = "base") %>%
  kable_styling(bootstrap_options = c("striped")) %>%
  scroll_box(height = "500px")
```

## Simple accuracy

```{r}
sum(BaseTest$simSpeciesPrediction == BaseTest$Species)/length(BaseTest$simSpeciesPrediction)
sum(FirstTest$SpeciesPrediction == FirstTest$Species)/length(FirstTest$SpeciesPrediction)
sum(SecondTest$SpeciesPrediction == SecondTest$Species)/length(SecondTest$SpeciesPrediction)
```

* calculate from Zach and from simulation
* sufficient (book quote)

## Confusion Matrix

* Describe boxes
* Describe overall statistics (Accuracy and Error)
* Describe other statistics
* link to helpful website (http://www.dataschool.io/simple-guide-to-confusion-matrix-terminology/)

* Wikipedia example

![https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values](wikiexample.png)

Accuracy = $\frac{20 + 1820}{2030} \approx 90.6%$

Looking at the confusion matrix gives better information - for example, the Positive predictive value is only 10%.

## Star Wars example

```{r}
BaseConfusionMatrix <- data.frame(Ewok = c(sum(BaseTest$Species == "Ewok" & BaseTest$simSpeciesPrediction == "Ewok"),
                                  sum(BaseTest$Species == "Ewok" & BaseTest$simSpeciesPrediction == "Human"),
                                  sum(BaseTest$Species == "Ewok" & BaseTest$simSpeciesPrediction == "Wookie")),
                              Human = c(sum(BaseTest$Species == "Human" & BaseTest$simSpeciesPrediction == "Ewok"),
                                  sum(BaseTest$Species == "Human" & BaseTest$simSpeciesPrediction == "Human"),
                                  sum(BaseTest$Species == "Human" & BaseTest$simSpeciesPrediction == "Wookie")),
                              Wookie = c(sum(BaseTest$Species == "Wookie" & BaseTest$simSpeciesPrediction == "Ewok"),
                                  sum(BaseTest$Species == "Wookie" & BaseTest$simSpeciesPrediction == "Human"),
                                  sum(BaseTest$Species == "Wookie" & BaseTest$simSpeciesPrediction == "Wookie")))
rownames(BaseConfusionMatrix) <- c("Ewok", "Human", "Wookie")           
```

```{r}
FirstConfusionMatrix <- data.frame(Ewok = c(sum(FirstTest$Species == "Ewok" & FirstTest$SpeciesPrediction == "Ewok"),
                                  sum(FirstTest$Species == "Ewok" & FirstTest$SpeciesPrediction == "Human"),
                                  sum(FirstTest$Species == "Ewok" & FirstTest$SpeciesPrediction == "Wookie")),
                              Human = c(sum(FirstTest$Species == "Human" & FirstTest$SpeciesPrediction == "Ewok"),
                                  sum(FirstTest$Species == "Human" & FirstTest$SpeciesPrediction == "Human"),
                                  sum(FirstTest$Species == "Human" & FirstTest$SpeciesPrediction == "Wookie")),
                              Wookie = c(sum(FirstTest$Species == "Wookie" & FirstTest$SpeciesPrediction == "Ewok"),
                                  sum(FirstTest$Species == "Wookie" & FirstTest$SpeciesPrediction == "Human"),
                                  sum(FirstTest$Species == "Wookie" & FirstTest$SpeciesPrediction == "Wookie")))
rownames(FirstConfusionMatrix) <- c("Ewok", "Human", "Wookie")
FirstConfusionMatrix
```

```{r}
SecondConfusionMatrix <- data.frame(Ewok = c(sum(SecondTest$Species == "Ewok" & SecondTest$SpeciesPrediction == "Ewok"),
                                  sum(SecondTest$Species == "Ewok" & SecondTest$SpeciesPrediction == "Human"),
                                  sum(SecondTest$Species == "Ewok" & SecondTest$SpeciesPrediction == "Wookie")),
                              Human = c(sum(SecondTest$Species == "Human" & SecondTest$SpeciesPrediction == "Ewok"),
                                  sum(SecondTest$Species == "Human" & SecondTest$SpeciesPrediction == "Human"),
                                  sum(SecondTest$Species == "Human" & SecondTest$SpeciesPrediction == "Wookie")),
                              Wookie = c(sum(SecondTest$Species == "Wookie" & SecondTest$SpeciesPrediction == "Ewok"),
                                  sum(SecondTest$Species == "Wookie" & SecondTest$SpeciesPrediction == "Human"),
                                  sum(SecondTest$Species == "Wookie" & SecondTest$SpeciesPrediction == "Wookie")))
rownames(SecondConfusionMatrix) <- c("Ewok", "Human", "Wookie")
SecondConfusionMatrix
```

## Confusion Matrix in R

* Calculate all three in R